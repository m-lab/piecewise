---
- hosts: all
  tasks:
    - include: update_pw_web.yml
      become: true
      become_user: root
- name: Fetch updated piecewise repo
  git: 
    repo: https://github.com/opentechinstitute/piecewise.git 
    dest: /opt/piecewise.git/
    version: master

- name: Deploy updated piecewise website code
  file:
    src: /opt/piecewise.git/{{ item }}
    dest: /opt/{{ item }}
    state: link
  with_items:
      - piecewise_web

- name: Restart services
  service: 
    name: "{{ item }}"
    state: restarted
  with_items: 
    - uwsgi
    - nginx
    